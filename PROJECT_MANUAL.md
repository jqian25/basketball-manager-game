# ç¯®çƒç»ç†æ¸¸æˆ - å®Œæ•´é¡¹ç›®æ‰‹å†Œ

## ğŸ“– ç›®å½•

1. [æ¸¸æˆä½¿ç”¨è¯´æ˜](#æ¸¸æˆä½¿ç”¨è¯´æ˜)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [ä»£ç æ¶æ„](#ä»£ç æ¶æ„)
4. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
6. [å®‰è£…ä¸éƒ¨ç½²](#å®‰è£…ä¸éƒ¨ç½²)
7. [åŠŸèƒ½æ‰©å±•æŒ‡å—](#åŠŸèƒ½æ‰©å±•æŒ‡å—)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¸¸æˆä½¿ç”¨è¯´æ˜

### ğŸ® æ¸¸æˆæ¨¡å¼

#### 1. æ¸¸å®¢æ¨¡å¼ï¼ˆå¿«é€Ÿä½“éªŒï¼‰
- **è®¿é—®è·¯å¾„**: `/` â†’ é€‰æ‹©"å¿«é€Ÿä½“éªŒ"
- **ç‰¹ç‚¹**:
  - æ— éœ€æ³¨å†Œï¼Œå³åˆ»å¼€å§‹
  - 3åˆ†é’Ÿå¿«é€Ÿæ¯”èµ›
  - ç®€åŒ–è§„åˆ™
  - æ— æ•°æ®ä¿å­˜
  - æ— çƒå‘˜æˆé•¿

#### 2. æ³¨å†Œç”¨æˆ·æ¨¡å¼ï¼ˆå®Œæ•´ä½“éªŒï¼‰
- **è®¿é—®è·¯å¾„**: `/` â†’ é€‰æ‹©"æ³¨å†Œ/ç™»å½•å®Œæ•´ç‰ˆ"
- **ç‰¹ç‚¹**:
  - NBAå®Œæ•´è§„åˆ™ï¼ˆ48åˆ†é’Ÿï¼‰
  - çƒå‘˜ç»éªŒæˆé•¿ç³»ç»Ÿ
  - ä¸ªäººçƒé˜Ÿç®¡ç†åå°
  - è¯¦ç»†æ•°æ®ç»Ÿè®¡åˆ†æ
  - æ€§æ„Ÿå•¦å•¦é˜Ÿè¡¨æ¼”
  - èµåŠ©å•†åˆä½œç³»ç»Ÿ
  - è”èµ›æ’åä¸å¥–åŠ±
  - **å¼€æ”¾ä¸–ç•ŒRPGæ¢ç´¢** â­

### ğŸ—ºï¸ å¼€æ”¾ä¸–ç•ŒRPGç³»ç»Ÿ

#### è®¿é—®æ–¹å¼
1. æ³¨å†Œå¹¶ç™»å½•
2. è¿›å…¥æ¸¸æˆèœå• (`/game`)
3. ç‚¹å‡»"å¼€æ”¾ä¸–ç•Œ"å¡ç‰‡

#### æ“ä½œæŒ‡å—
- **ç§»åŠ¨**: WASD æˆ– æ–¹å‘é”®
- **å¥”è·‘**: æŒ‰ä½ Shift
- **äº¤äº’**: Space æˆ– Enterï¼ˆé è¿‘NPCæ—¶ï¼‰
- **é€€å‡ºå¯¹è¯**: ESC

#### åœºæ™¯ä»‹ç»

**æ¹˜åŒ—é«˜ä¸­åœºæ™¯** (`/openworld`)
- **åœ°å›¾å¤§å°**: 60x45 æ ¼å­
- **ä¸»è¦åŒºåŸŸ**:
  - æ•™å­¦æ¥¼ï¼ˆå·¦ä¸Šï¼‰
  - ä½“è‚²é¦†ï¼ˆå³ä¸Šï¼‰
  - ç¯®çƒåœºï¼ˆä¸­ä¸‹ï¼‰
  - é“è·¯ç³»ç»Ÿ
  - ä¼‘æ¯åŒº

**NPCè§’è‰²**:
1. **å®‰è¥¿æ•™ç»ƒ** (38, 23) - ä½“è‚²é¦†é™„è¿‘
   - æ€§æ ¼ï¼šç¿æ™ºæ…ˆç¥¥
   - ç‰¹ç‚¹ï¼šå–„äºç”¨ç®€å•è¯è¯­ç‚¹é†’çƒå‘˜
   
2. **æ¨±æœ¨èŠ±é“** (35, 30) - ç¯®çƒåœºä¸Š
   - æ€§æ ¼ï¼šçƒ­è¡€å†²åŠ¨
   - ç‰¹ç‚¹ï¼šè‡ªç§°å¤©æ‰ï¼Œå……æ»¡çƒ­æƒ…
   
3. **æµå·æ«** (40, 30) - ç¯®çƒåœºä¸Š
   - æ€§æ ¼ï¼šå†·é…·å¯¡è¨€
   - ç‰¹ç‚¹ï¼šç¯®çƒå¤©æ‰ï¼Œè¯å¾ˆå°‘
   
4. **å½©å­** (36, 27) - ç¯®çƒåœºé™„è¿‘
   - æ€§æ ¼ï¼šæ¸©æŸ”è´Ÿè´£
   - ç‰¹ç‚¹ï¼šçƒé˜Ÿç»ç†ï¼Œå…³å¿ƒçƒå‘˜
   
5. **æ¸…æ´å·¥å¤§å”** (25, 22) - é“è·¯ä¸Š
   - æ€§æ ¼ï¼šäº²åˆ‡å¥è°ˆ
   - ç‰¹ç‚¹ï¼šè§è¯å­¦æ ¡å†å²

#### AIå¯¹è¯ç³»ç»Ÿ
- æ¯ä¸ªNPCéƒ½æœ‰ç‹¬ç‰¹çš„AIäººæ ¼
- æ”¯æŒè‡ªç„¶è¯­è¨€å¯¹è¯
- å¯¹è¯ä¼šæ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆ
- å…³é”®è¯è§¦å‘ç‰¹å®šå›å¤ï¼ˆç¯®çƒã€è®­ç»ƒã€æ¯”èµ›ç­‰ï¼‰

---

## é¡¹ç›®ç»“æ„

```
basketball_manager/
â”œâ”€â”€ client/                          # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/             # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ kairo/             # Kairosoftæ¸¸æˆç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ClubOverview.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerManagement.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FacilityManagement.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ openWorld/         # å¼€æ”¾ä¸–ç•Œç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OpenWorldGame.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ui/                # UIç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.tsx           # ä¸»é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ Game.tsx           # æ¸¸æˆèœå•
â”‚   â”‚   â”‚   â”œâ”€â”€ OpenWorld.tsx      # å¼€æ”¾ä¸–ç•Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ Match.tsx          # æ¯”èµ›
â”‚   â”‚   â”‚   â””â”€â”€ PlayerManage.tsx   # çƒå‘˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ systems/               # æ¸¸æˆç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ kairo/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ThemedAreaSystem.ts  # ä¸»é¢˜åŒºåŸŸç³»ç»Ÿ
â”‚   â”‚   â”‚   â””â”€â”€ openWorld/
â”‚   â”‚   â”‚       â”œâ”€â”€ PlayerController.ts   # ç©å®¶æ§åˆ¶å™¨
â”‚   â”‚   â”‚       â””â”€â”€ NPCDialogueSystem.ts  # NPCå¯¹è¯ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ data/                  # æ¸¸æˆæ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ kairo/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ facilitiesDatabase.ts # è®¾æ–½æ•°æ®åº“
â”‚   â”‚   â”‚   â””â”€â”€ maps/              # åœ°å›¾æ•°æ®
â”‚   â”‚   â”‚       â”œâ”€â”€ worldMap.ts    # ä¸–ç•Œåœ°å›¾
â”‚   â”‚   â”‚       â”œâ”€â”€ tokyoCityMap.ts # ä¸œäº¬åŸå¸‚åœ°å›¾
â”‚   â”‚   â”‚       â””â”€â”€ shohokuSchoolMap.ts # æ¹˜åŒ—é«˜ä¸­åœ°å›¾
â”‚   â”‚   â”œâ”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ kairo.ts
â”‚   â”‚   â”‚   â””â”€â”€ openWorld.ts
â”‚   â”‚   â””â”€â”€ App.tsx                # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ public/                    # é™æ€èµ„æº
â”‚       â””â”€â”€ kairo/                 # Kairosoftåƒç´ è‰ºæœ¯èµ„æº
â”‚           â”œâ”€â”€ facilities/        # 60ä¸ªè®¾æ–½å»ºç­‘
â”‚           â”œâ”€â”€ nature/            # 50ä¸ªè‡ªç„¶å…ƒç´ 
â”‚           â”œâ”€â”€ decorations/       # 80ä¸ªè£…é¥°ç‰©å“
â”‚           â”œâ”€â”€ courts/            # 20ä¸ªçƒåœºèµ„æº
â”‚           â”œâ”€â”€ characters/        # è§’è‰²ç²¾çµå›¾
â”‚           â””â”€â”€ icons/             # UIå›¾æ ‡
â”‚
â”œâ”€â”€ server/                         # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ _core/
â”‚   â”‚   â”œâ”€â”€ index.ts               # æœåŠ¡å™¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ oauth.ts               # OAuthè®¤è¯
â”‚   â”‚   â””â”€â”€ context.ts             # tRPCä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ ai.ts                  # AIå¯¹è¯API
â”‚   â”œâ”€â”€ routers/                   # tRPCè·¯ç”±
â”‚   â””â”€â”€ db/
â”‚       â””â”€â”€ schema-npc-marketplace.ts # NPCå¸‚åœºSchema
â”‚
â”œâ”€â”€ drizzle/                        # æ•°æ®åº“
â”‚   â”œâ”€â”€ schema.ts                  # æ•°æ®åº“Schema
â”‚   â””â”€â”€ migrations/                # è¿ç§»æ–‡ä»¶
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£
â”‚   â””â”€â”€ themed-areas-reference.md  # ä¸»é¢˜åŒºåŸŸå‚è€ƒ
â”‚
â”œâ”€â”€ package.json                   # é¡¹ç›®é…ç½®
â”œâ”€â”€ drizzle.config.ts             # Drizzleé…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â””â”€â”€ vite.config.ts                # Viteé…ç½®
```

---

## ä»£ç æ¶æ„

### å‰ç«¯æ¶æ„

#### 1. ç»„ä»¶å±‚æ¬¡
```
App
â”œâ”€â”€ Router
â”‚   â”œâ”€â”€ Home (ä¸»é¡µ)
â”‚   â”œâ”€â”€ Game (æ¸¸æˆèœå•)
â”‚   â”œâ”€â”€ OpenWorld (å¼€æ”¾ä¸–ç•Œ)
â”‚   â”œâ”€â”€ Match (æ¯”èµ›)
â”‚   â””â”€â”€ PlayerManage (çƒå‘˜ç®¡ç†)
```

#### 2. çŠ¶æ€ç®¡ç†
- **useAuth**: ç”¨æˆ·è®¤è¯çŠ¶æ€
- **useState/useRef**: æœ¬åœ°ç»„ä»¶çŠ¶æ€
- **æ¸¸æˆå¾ªç¯**: requestAnimationFrame

#### 3. æ¸²æŸ“ç³»ç»Ÿ
- **Canvas 2D**: åœ°å›¾å’Œè§’è‰²æ¸²æŸ“
- **Reactç»„ä»¶**: UIç•Œé¢
- **å®æ—¶æ›´æ–°**: 60fpsæ¸¸æˆå¾ªç¯

### åç«¯æ¶æ„

#### 1. APIå±‚
- **tRPC**: ç±»å‹å®‰å…¨çš„API
- **Express**: HTTPæœåŠ¡å™¨
- **REST API**: AIå¯¹è¯æ¥å£

#### 2. æ•°æ®å±‚
- **Drizzle ORM**: æ•°æ®åº“æ“ä½œ
- **MySQL**: æ•°æ®å­˜å‚¨

#### 3. è®¤è¯å±‚
- **OAuth 2.0**: Manuså¹³å°è®¤è¯
- **JWT**: ä¼šè¯ç®¡ç†

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### æ¨¡å—1: ä¸»é¡µç³»ç»Ÿ (Home.tsx)

**åŠŸèƒ½**:
- å¼€åœºåŠ¨ç”»å±•ç¤º
- æ¸¸å®¢/æ³¨å†Œæ¨¡å¼é€‰æ‹©
- è‡ªåŠ¨ç™»å½•æ£€æµ‹

**å…³é”®ä»£ç **:
```typescript
const handleGuestLogin = () => {
  setLocation("/game"); // æ¸¸å®¢ç›´æ¥è¿›å…¥æ¸¸æˆ
};

const handleUserLogin = () => {
  window.location.href = getLoginUrl(); // OAuthç™»å½•
};
```

### æ¨¡å—2: å¼€æ”¾ä¸–ç•Œç³»ç»Ÿ (OpenWorldGame.tsx)

**æ ¸å¿ƒç»„ä»¶**:
1. **ç©å®¶æ§åˆ¶å™¨** (PlayerController.ts)
   - å¤„ç†é”®ç›˜è¾“å…¥
   - è®¡ç®—ç§»åŠ¨å’Œç¢°æ’
   - æ›´æ–°ç©å®¶çŠ¶æ€

2. **NPCå¯¹è¯ç³»ç»Ÿ** (NPCDialogueSystem.ts)
   - ç®¡ç†å¯¹è¯ä¼šè¯
   - è°ƒç”¨AIç”Ÿæˆå›å¤
   - ä¿å­˜å¯¹è¯å†å²

3. **åœ°å›¾æ¸²æŸ“å™¨**
   - Canvasç»˜åˆ¶ç“¦ç‰‡
   - ç›¸æœºè·Ÿéšç©å®¶
   - æ¸²æŸ“NPCå’Œå¯¹è±¡

**å…³é”®ä»£ç **:
```typescript
// æ¸¸æˆå¾ªç¯
const gameLoop = () => {
  const deltaTime = (now - lastTime) / 1000;
  playerController.update(deltaTime);
  render();
  requestAnimationFrame(gameLoop);
};

// ç¢°æ’æ£€æµ‹
private canMoveTo(x: number, y: number): boolean {
  // æ£€æŸ¥åœ°å›¾è¾¹ç•Œ
  // æ£€æŸ¥ç“¦ç‰‡å¯è¡Œèµ°æ€§
  // æ£€æŸ¥ä¸å¯¹è±¡çš„ç¢°æ’
  return true/false;
}
```

### æ¨¡å—3: Kairosoftæ¸¸æˆç³»ç»Ÿ

**æ ¸å¿ƒç»„ä»¶**:
1. **è®¾æ–½æ•°æ®åº“** (facilitiesDatabase.ts)
   - 60ä¸ªè®¾æ–½å®šä¹‰
   - å±æ€§ã€æˆæœ¬ã€æ•ˆæœ
   - åˆ†ç±»å’Œç­›é€‰

2. **ä¸»é¢˜åŒºåŸŸç³»ç»Ÿ** (ThemedAreaSystem.ts)
   - 63ä¸ªååŒåŒºåŸŸå®šä¹‰
   - ç›¸é‚»æ£€æµ‹ç®—æ³•
   - æ•ˆæœè®¡ç®—å¼•æ“

**å…³é”®ä»£ç **:
```typescript
// æ£€æµ‹ä¸»é¢˜åŒºåŸŸ
static detectThemedAreas(placements: FacilityPlacement[]): DetectedThemedArea[] {
  const detectedAreas: DetectedThemedArea[] = [];
  
  for (const areaDefinition of THEMED_AREAS) {
    const matches = this.findAreaMatches(areaDefinition, placements);
    detectedAreas.push(...matches);
  }
  
  return detectedAreas;
}

// è®¡ç®—æ€»æ•ˆæœ
static calculateTotalEffects(detectedAreas: DetectedThemedArea[]) {
  // ç´¯åŠ æ‰€æœ‰åŒºåŸŸçš„æ•ˆæœåŠ æˆ
  return { price, popular, exp, upkeep, ... };
}
```

---

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨

#### 1. users (ç”¨æˆ·è¡¨)
```sql
- id: ä¸»é”®
- openId: OAuthå”¯ä¸€æ ‡è¯†
- name: ç”¨æˆ·å
- role: è§’è‰² (user/admin)
- createdAt: åˆ›å»ºæ—¶é—´
```

#### 2. players (çƒå‘˜è¡¨)
```sql
- id: ä¸»é”®
- userId: æ‰€å±ç”¨æˆ·
- name: çƒå‘˜å
- position: ä½ç½® (PG/SG/SF/PF/C)
- scoring, passing, defense: å…­ç»´å±æ€§
- experience, level: ç»éªŒå’Œç­‰çº§
```

#### 3. npcMarketplace (NPCå¸‚åœºè¡¨)
```sql
- id: ä¸»é”®
- npcId: NPCå”¯ä¸€æ ‡è¯†
- name: NPCåç§°
- category: åˆ†ç±»
- basePrice: åŸºç¡€ä»·æ ¼
- premiumPrice: é«˜çº§ç‰ˆä»·æ ¼
- defaultPersonality: é»˜è®¤æ€§æ ¼
```

#### 4. userNpcs (ç”¨æˆ·æ‹¥æœ‰çš„NPCè¡¨)
```sql
- id: ä¸»é”®
- userId: ç”¨æˆ·ID
- npcMarketplaceId: å…³è”NPCå•†å“
- customName: è‡ªå®šä¹‰åç§°
- isPremium: æ˜¯å¦é«˜çº§ç‰ˆ
- aiConfig: AIé…ç½® (JSON)
- placement: æ”¾ç½®ä½ç½® (JSON)
```

#### 5. mapCustomObjects (åœ°å›¾è‡ªå®šä¹‰å¯¹è±¡è¡¨)
```sql
- id: ä¸»é”®
- userId: ç”¨æˆ·ID
- mapId: åœ°å›¾ID
- objectType: å¯¹è±¡ç±»å‹
- objectData: å¯¹è±¡æ•°æ® (JSON)
```

### å…³ç³»å›¾
```
users (1) ----< (N) players
users (1) ----< (N) userNpcs
users (1) ----< (N) mapCustomObjects
npcMarketplace (1) ----< (N) userNpcs
```

---

## å®‰è£…ä¸éƒ¨ç½²

### å¼€å‘ç¯å¢ƒè¦æ±‚
- Node.js >= 18
- pnpm >= 8
- MySQL >= 8.0

### å®‰è£…æ­¥éª¤

#### 1. è§£å‹é¡¹ç›®
```bash
tar -xzf basketball_manager_complete.tar.gz
cd basketball_manager
```

#### 2. å®‰è£…ä¾èµ–
```bash
pnpm install
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=mysql://user:password@localhost:3306/basketball_manager

# OAuthé…ç½®
OAUTH_CLIENT_ID=your_client_id
OAUTH_CLIENT_SECRET=your_client_secret
OAUTH_REDIRECT_URI=http://localhost:3000/api/oauth/callback

# JWTå¯†é’¥
JWT_SECRET=your_jwt_secret

# æœåŠ¡å™¨ç«¯å£
PORT=3000
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“
```bash
# ç”Ÿæˆå¹¶åº”ç”¨è¿ç§»
pnpm db:push
```

#### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
pnpm dev
```

è®¿é—® http://localhost:3000

### ç”Ÿäº§éƒ¨ç½²

#### 1. æ„å»ºé¡¹ç›®
```bash
pnpm build
```

#### 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```bash
NODE_ENV=production node server/_core/index.js
```

#### 3. ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹
```bash
pm2 start server/_core/index.js --name basketball-manager
pm2 save
pm2 startup
```

---

## åŠŸèƒ½æ‰©å±•æŒ‡å—

### ğŸ—ºï¸ æ·»åŠ æ–°åœ°å›¾

#### 1. åˆ›å»ºåœ°å›¾æ•°æ®æ–‡ä»¶
```typescript
// client/src/data/maps/newMap.ts
import type { SceneMap } from "../../types/openWorld";

export const NEW_MAP: SceneMap = {
  metadata: {
    id: "scene-new-map",
    name: "æ–°åœ°å›¾",
    level: "scene",
    width: 50,
    height: 40,
    tileSize: 32
  },
  tiles: createTileGrid(50, 40),
  objects: [],
  npcs: [],
  portals: [],
  basketballCourts: [],
  spawnPoint: { x: 25, y: 20 },
  sceneName: "æ–°åœ°å›¾",
  sceneType: "school"
};
```

#### 2. æ·»åŠ ä¼ é€é—¨
åœ¨ç°æœ‰åœ°å›¾ä¸­æ·»åŠ ä¼ é€é—¨ï¼š
```typescript
portals: [
  {
    id: "portal-to-new-map",
    type: "portal",
    x: 30,
    y: 40,
    targetMapId: "scene-new-map",
    targetX: 25,
    targetY: 20,
    requiresInteraction: true,
    transitionEffect: "fade"
  }
]
```

### ğŸ‘¤ æ·»åŠ æ–°NPC

#### 1. åœ¨åœ°å›¾æ•°æ®ä¸­æ·»åŠ NPC
```typescript
npcs: [
  {
    id: "npc-new-character",
    type: "npc",
    name: "æ–°è§’è‰²",
    x: 30,
    y: 30,
    spriteSheet: "/characters/new-character.png",
    interactable: true,
    movementPattern: "static",
    aiPersonality: "å‹å¥½çƒ­æƒ…ï¼Œå–œæ¬¢èŠç¯®çƒ"
  }
]
```

#### 2. æ·»åŠ åˆ°NPCå¸‚åœºï¼ˆå¯é€‰ï¼‰
```sql
INSERT INTO npcMarketplace (
  npcId, name, category, basePrice, 
  premiumPrice, defaultPersonality, spriteSheet
) VALUES (
  'npc-new-character', 'æ–°è§’è‰²', 'student', 
  9.99, 19.99, 'å‹å¥½çƒ­æƒ…', '/characters/new-character.png'
);
```

### ğŸ¢ æ·»åŠ æ–°è®¾æ–½

#### 1. åœ¨è®¾æ–½æ•°æ®åº“ä¸­æ·»åŠ 
```typescript
// client/src/data/kairo/facilitiesDatabase.ts
{
  id: "new-facility",
  name: "æ–°è®¾æ–½",
  category: "training",
  description: "ä¸€ä¸ªå…¨æ–°çš„è®­ç»ƒè®¾æ–½",
  cost: 50000,
  maintenanceCost: 500,
  unlockLevel: 5,
  effects: {
    training: 15,
    morale: 5
  },
  imagePath: "/kairo/facilities/new-facility.png"
}
```

#### 2. æ·»åŠ åˆ°ä¸»é¢˜åŒºåŸŸï¼ˆå¯é€‰ï¼‰
```typescript
// client/src/systems/kairo/ThemedAreaSystem.ts
{
  id: "new-area",
  name: "æ–°åŒºåŸŸ",
  facilities: ["new-facility", "other-facility"],
  effect: { type: "exp", value: 15 },
  description: "æ–°è®¾æ–½å’Œå…¶ä»–è®¾æ–½çš„ç»„åˆ"
}
```

### ğŸ¨ æ·»åŠ æ–°åƒç´ è‰ºæœ¯èµ„æº

#### 1. å‡†å¤‡å›¾ç‰‡
- æ ¼å¼ï¼šPNGï¼ˆé€æ˜èƒŒæ™¯ï¼‰
- å°ºå¯¸ï¼š32x32 æˆ– 64x64 åƒç´ 
- é£æ ¼ï¼šKairosoftç­‰è½´æµ‹é£æ ¼

#### 2. æ”¾ç½®åˆ°å¯¹åº”ç›®å½•
```
client/public/kairo/
â”œâ”€â”€ facilities/     # è®¾æ–½å»ºç­‘
â”œâ”€â”€ nature/         # è‡ªç„¶å…ƒç´ 
â”œâ”€â”€ decorations/    # è£…é¥°ç‰©å“
â”œâ”€â”€ characters/     # è§’è‰²ç²¾çµå›¾
â””â”€â”€ icons/          # UIå›¾æ ‡
```

#### 3. åœ¨ä»£ç ä¸­å¼•ç”¨
```typescript
imagePath: "/kairo/facilities/your-image.png"
```

### ğŸ¤– è‡ªå®šä¹‰AIå¯¹è¯

#### 1. ä¿®æ”¹AIäººæ ¼
```typescript
aiPersonality: "ä½ çš„è‡ªå®šä¹‰äººæ ¼æè¿°ï¼šæ€§æ ¼ç‰¹ç‚¹ã€è¯´è¯é£æ ¼ã€ä¸“é•¿é¢†åŸŸç­‰"
```

#### 2. æ·»åŠ å…³é”®è¯å›å¤
åœ¨ `server/routes/ai.ts` ä¸­æ·»åŠ ï¼š
```typescript
if (lowerMessage.includes("ä½ çš„å…³é”®è¯")) {
  const responses = [
    "å›å¤1",
    "å›å¤2",
    "å›å¤3"
  ];
  return responses[Math.floor(Math.random() * responses.length)];
}
```

#### 3. æ¥å…¥çœŸå®å¤§æ¨¡å‹
æ›¿æ¢ `generateRuleBasedResponse` å‡½æ•°ï¼š
```typescript
// è°ƒç”¨OpenAI API
const response = await fetch("https://api.openai.com/v1/chat/completions", {
  method: "POST",
  headers: {
    "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`,
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    model: "gpt-4",
    messages: messages
  })
});
```

### ğŸ“Š æ·»åŠ æ–°é¡µé¢

#### 1. åˆ›å»ºé¡µé¢ç»„ä»¶
```typescript
// client/src/pages/NewPage.tsx
export default function NewPage() {
  return (
    <div>
      <h1>æ–°é¡µé¢</h1>
    </div>
  );
}
```

#### 2. æ·»åŠ è·¯ç”±
```typescript
// client/src/App.tsx
import NewPage from "./pages/NewPage";

<Route path={"/newpage"} component={NewPage} />
```

#### 3. æ·»åŠ èœå•å…¥å£
```typescript
// client/src/pages/Game.tsx
{
  icon: YourIcon,
  title: "æ–°åŠŸèƒ½",
  description: "æ–°åŠŸèƒ½æè¿°",
  color: "from-color-500 to-color-600",
  path: "/newpage",
  available: true
}
```

---

## å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥
**A**: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨ã€‚

### Q2: NPCå¯¹è¯æ²¡æœ‰ååº”
**A**: æ£€æŸ¥ï¼š
1. AI APIè·¯ç”±æ˜¯å¦æ­£ç¡®æ³¨å†Œ
2. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. NPCçš„ `interactable` å±æ€§æ˜¯å¦ä¸º `true`

### Q3: åœ°å›¾æ¸²æŸ“ç©ºç™½
**A**: æ£€æŸ¥ï¼š
1. Canvaså…ƒç´ æ˜¯å¦æ­£ç¡®åˆ›å»º
2. åœ°å›¾æ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½
3. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### Q4: çƒå‘˜å±æ€§ä¸ç”Ÿæ•ˆ
**A**: ç¡®ä¿ï¼š
1. æ•°æ®åº“Schemaå·²æ›´æ–° (`pnpm db:push`)
2. å±æ€§å€¼åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ1-20ï¼‰
3. å‰åç«¯ç±»å‹å®šä¹‰ä¸€è‡´

### Q5: å¦‚ä½•é‡ç½®æ•°æ®åº“
**A**: 
```bash
# åˆ é™¤æ‰€æœ‰è¡¨
pnpm db:drop

# é‡æ–°ç”ŸæˆSchema
pnpm db:push
```

### Q6: å¦‚ä½•è°ƒè¯•æ¸¸æˆå¾ªç¯
**A**: åœ¨ `OpenWorldGame.tsx` ä¸­æ·»åŠ ï¼š
```typescript
console.log("Player position:", player.x, player.y);
console.log("FPS:", 1 / deltaTime);
```

### Q7: å¦‚ä½•ä¼˜åŒ–æ€§èƒ½
**A**: 
1. å‡å°‘Canvasé‡ç»˜èŒƒå›´
2. ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†NPC
3. å®ç°è§†é‡è£å‰ªï¼ˆåªæ¸²æŸ“å¯è§åŒºåŸŸï¼‰
4. ä½¿ç”¨Web Workerå¤„ç†AIè®¡ç®—

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ–‡æ¡£: `/docs`
- ä»£ç æ³¨é‡Š: æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è¯¦ç»†æ³¨é‡Š
- TypeScriptç±»å‹: `/client/src/types`

---

## ğŸ‰ ç»“è¯­

è¿™ä¸ªé¡¹ç›®é‡‡ç”¨**æ¨¡å—åŒ–è®¾è®¡**ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯**ç‹¬ç«‹å¯æ‰©å±•**çš„ã€‚ä½ å¯ä»¥ï¼š
- æ·»åŠ æ–°åœ°å›¾å’Œåœºæ™¯
- åˆ›å»ºæ›´å¤šNPCè§’è‰²
- è®¾è®¡æ–°çš„æ¸¸æˆæœºåˆ¶
- é›†æˆæ›´å¤šAIåŠŸèƒ½
- å¼€å‘åå°ç®¡ç†ç³»ç»Ÿ

ç¥ä½ å¼€å‘æ„‰å¿«ï¼ğŸ€

